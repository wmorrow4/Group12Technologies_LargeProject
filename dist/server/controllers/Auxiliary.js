'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
const util = require("util");
const db = require("../db");
const mongodb_1 = require("mongodb");
const OK = 200;
const BadRequest = 400;
const InternalServerError = 500;
const inspect = (input) => util.inspect(input, false, Infinity, true);
module.exports.ClaimAppointment = function (req, res) {
    console.log(util.inspect(req.swagger.params, false, Infinity, true));
    res.setHeader('Content-Type', 'application/json');
    var claimappointmentObject = req.swagger.params.claimappointment.value;
    if (!req.session) {
        res.status(BadRequest);
        res.send(JSON.stringify({ message: "Invalid session" }, null, 2));
        res.end();
    }
    if (!req.session.email) {
        res.status(BadRequest);
        res.send(JSON.stringify({ message: "Login required" }, null, 2));
        res.end();
    }
    db.Schedule.findOne({ _id: new mongodb_1.ObjectID(claimappointmentObject.s_id) }, function (err, result) {
        if (err) {
            res.status(InternalServerError);
            res.send(JSON.stringify({ message: inspect(err) }, null, 2));
            res.end();
        }
        if (!result) {
            res.status(BadRequest);
            res.send(JSON.stringify({ messagge: "Schedule Doesn't exist" }, null, 2));
            res.end();
        }
        else {
            db.Reservation.insertOne(claimappointmentObject, function (err, result) {
                if (err) {
                    res.status(InternalServerError);
                    res.send(JSON.stringify({ message: inspect(err) }, null, 2));
                    res.end();
                }
                if (!result) {
                    res.status(BadRequest);
                    res.send(JSON.stringify({ message: "Claim Appointment Function Failed" }, null, 2));
                    res.end();
                }
                else {
                    res.status(OK);
                    res.send(JSON.stringify({ message: "Claimed Appointment Succesfully" }, null, 2));
                    res.end();
                }
            });
        }
    });
};
module.exports.ListmySchedules = function (req, res) {
    console.log(util.inspect(req.swagger.params, false, Infinity, true));
    res.setHeader('Content-Type', 'application/json');
    if (!req.session) {
        return;
    }
    db.Schedule.find({
        schedulerID: new mongodb_1.ObjectID(req.session.logid)
    }).toArray().then((data) => {
        if (data) {
            res.status(OK);
            res.send(JSON.stringify(data));
            res.end();
        }
        else {
            res.status(OK);
            res.send(JSON.stringify([], null, 2));
            res.end();
        }
    }).catch((err) => {
        res.status(InternalServerError);
        res.send(JSON.stringify({ message: inspect(err) }, null, 2));
        res.end();
    });
};
module.exports.ListSchedules = function (req, res) {
    console.log(util.inspect(req.swagger.params, false, Infinity, true));
    res.setHeader('Content-Type', 'application/json');
    if (!req.session) {
        return;
    }
    db.Schedule.find({
        schedulerID: new mongodb_1.ObjectID(req.swagger.params.list.value.schedulerID)
    }).toArray().then((data) => {
        if (data) {
            res.status(OK);
            res.send(JSON.stringify(data));
            res.end();
        }
        else {
            res.status(OK);
            res.send(JSON.stringify([], null, 2));
            res.end();
        }
    }).catch((err) => {
        res.status(InternalServerError);
        res.send(JSON.stringify({ message: inspect(err) }, null, 2));
        res.end();
    });
};
module.exports.SchedulerEditInfo = function (req, res) {
    console.log(util.inspect(req.swagger.params, false, Infinity, true));
    res.setHeader('Content-Type', 'application/json');
    if (req.session && req.session.logid) {
        db.Scheduler.find({
            _id: new mongodb_1.ObjectID(req.swagger.params.scheduler.value._id)
        }).toArray().then((data) => {
            if (data.length) {
                if (data[0].schedulerID.equals(new mongodb_1.ObjectID(req.session.logid))) {
                    db.Scheduler.replaceOne({
                        _id: new mongodb_1.ObjectID(req.swagger.params.scheduler.value._id)
                    }, {
                        schedulerID: data[0].schedulerID,
                        group: req.swagger.params.scheduler.value.group,
                        email: req.swagger.params.scheduler.value.email,
                        password: req.swagger.params.scheduler.value.password,
                    }).then(updateWriteOpResult => {
                        res.status(OK);
                        res.send(JSON.stringify({ message: "Update successful!" }, null, 2));
                        res.end();
                    }).catch(err => {
                        res.status(InternalServerError);
                        res.send(JSON.stringify({ message: inspect(err) }, null, 2));
                        res.end();
                    });
                }
                else {
                    res.status(BadRequest);
                    res.send(JSON.stringify({ message: `Could not update info ${req.session.email}:${req.session.logid}` }, null, 2));
                    res.end();
                }
            }
            else {
                res.status(BadRequest);
                res.send(JSON.stringify({ message: `This scheduler does not exist: ${req.swagger.params.scheduler.value._id}` }, null, 2));
                res.end();
            }
        }).catch((err) => {
            res.status(InternalServerError);
            res.send(JSON.stringify({ message: inspect(err) }, null, 2));
            res.end();
        });
    }
    else {
        res.status(BadRequest);
        res.send(JSON.stringify({ message: "You must be logged in to use this feature." }, null, 2));
        res.end();
    }
};
module.exports.UserEditInfo = function (req, res) {
    console.log(util.inspect(req.swagger.params, false, Infinity, true));
    res.setHeader('Content-Type', 'application/json');
    if (req.session && req.session.logid) {
        db.User.find({
            _id: new mongodb_1.ObjectID(req.swagger.params.user.value._id)
        }).toArray().then((data) => {
            if (data.length) {
                if (data[0]._id.equals(new mongodb_1.ObjectID(req.session.logid))) {
                    db.User.replaceOne({
                        _id: new mongodb_1.ObjectID(req.swagger.params.user.value._id)
                    }, {
                        _id: data[0]._id,
                        firstname: req.swagger.params.user.value.firstname,
                        lastname: req.swagger.params.user.value.lastname,
                        email: req.swagger.params.user.value.email,
                        password: req.swagger.params.user.value.password,
                    }).then(updateWriteOpResult => {
                        res.status(OK);
                        res.send(JSON.stringify({ message: "Update successful!" }, null, 2));
                        res.end();
                    }).catch(err => {
                        res.status(InternalServerError);
                        res.send(JSON.stringify({ message: inspect(err) }, null, 2));
                        res.end();
                    });
                }
                else {
                    res.status(BadRequest);
                    res.send(JSON.stringify({ message: `Could not update info ${req.session.email}:${req.session.logid}` }, null, 2));
                    res.end();
                }
            }
            else {
                res.status(BadRequest);
                res.send(JSON.stringify({ message: `This user does not exist: ${req.swagger.params.user.value._id}` }, null, 2));
                res.end();
            }
        }).catch((err) => {
            res.status(InternalServerError);
            res.send(JSON.stringify({ message: inspect(err) }, null, 2));
            res.end();
        });
    }
    else {
        res.status(BadRequest);
        res.send(JSON.stringify({ message: "You must be logged in to use this feature." }, null, 2));
        res.end();
    }
};
module.exports.ListAppointments = function (req, res) {
    console.log(util.inspect(req.swagger.params, false, Infinity, true));
    res.setHeader('Content-Type', 'application/json');
    if (!req.session) {
        return;
    }
    db.Reservation.find({
        UserID: new mongodb_1.ObjectID(req.session.logid)
    }).toArray().then((data) => {
        if (data) {
            res.status(OK);
            res.send(JSON.stringify(data));
            res.end();
        }
        else {
            res.status(OK);
            res.send(JSON.stringify([], null, 2));
            res.end();
        }
    }).catch((err) => {
        res.status(InternalServerError);
        res.send(JSON.stringify({ message: inspect(err) }, null, 2));
        res.end();
    });
};
module.exports.ListSchedulers = function (req, res) {
    console.log(util.inspect(req.swagger.params, false, Infinity, true));
    res.setHeader('Content-Type', 'application/json');
    if (!req.session) {
        return;
    }
    db.Scheduler.find({}).toArray().then((data) => {
        if (data) {
            res.status(OK);
            res.send(JSON.stringify(data));
            res.end();
        }
        else {
            res.status(OK);
            res.send(JSON.stringify([], null, 2));
            res.end();
        }
    }).catch((err) => {
        res.status(InternalServerError);
        res.send(JSON.stringify({ message: inspect(err) }, null, 2));
        res.end();
    });
};

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9zZXJ2ZXIvY29udHJvbGxlcnMvQXV4aWxpYXJ5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFlBQVksQ0FBQzs7QUFFYiw2QkFBNkI7QUFHN0IsNEJBQTRCO0FBUTVCLHFDQU1pQjtBQUdqQixNQUFNLEVBQUUsR0FBRyxHQUFHLENBQUE7QUFDZCxNQUFNLFVBQVUsR0FBRyxHQUFHLENBQUE7QUFDdEIsTUFBTSxtQkFBbUIsR0FBRyxHQUFHLENBQUE7QUFFL0IsTUFBTSxPQUFPLEdBQUcsQ0FBQyxLQUFVLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsSUFBSSxDQUFDLENBQUE7QUFzQzFFLE1BQU0sQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLEdBQUcsVUFBVSxHQUF5RSxFQUFFLEdBQXFCO0lBRXhJLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUE7SUFDcEUsR0FBRyxDQUFDLFNBQVMsQ0FBQyxjQUFjLEVBQUUsa0JBQWtCLENBQUMsQ0FBQTtJQUVqRCxJQUFJLHNCQUFzQixHQUFHLEdBQUcsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLGdCQUFnQixDQUFDLEtBQUssQ0FBQztJQUV2RSxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRTtRQUNkLEdBQUcsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUE7UUFDdEIsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFDakUsR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFBO0tBQ1o7SUFDRCxJQUFJLENBQUMsR0FBRyxDQUFDLE9B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QUUsSUFBSSxDQUFDLENBQUMsQ0FBQTtJQUVwRSxHQUFHLENBQUMsU0FBUyxDQUFDLGNBQWMsRUFBRSxrQkFBa0IsQ0FBQyxDQUFBO0lBQ2pELElBQUksQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFO1FBQ2QsT0FBTTtLQUNUO0lBQ0QsRUFBRSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUU7UUFFMUMsSUFBSSxJQUFJLEVBQUU7WUFDTixHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFBO1lBQ2QsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUE7WUFDOUIsR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFBO1NBQ1o7YUFDSTtZQUNELEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUE7WUFDZCxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFBO1lBQ3JDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQTtTQUNaO0lBRUwsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUU7UUFDYixHQUFHLENBQUMsTUFBTSxDQUFDLG1CQUFtQixDQUFDLENBQUE7UUFDL0IsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUUsT0FBTyxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFBO1FBQzVELEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQTtJQUNiLENBQUMsQ0FBQyxDQUFBO0FBQ04sQ0FBQyxDQUFDIiwiZmlsZSI6InNlcnZlci9jb250cm9sbGVycy9BdXhpbGlhcnkuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmltcG9ydCB1dGlsID0gcmVxdWlyZSgndXRpbCcpXG5pbXBvcnQgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKVxuaW1wb3J0IHN3YWdnZXJUb29scyA9IHJlcXVpcmUoJ3N3YWdnZXItdG9vbHMnKVxuaW1wb3J0IGRiID0gcmVxdWlyZSgnLi4vZGInKVxuaW1wb3J0IGFwaSA9IHJlcXVpcmUoJy4uL2FwaScpXG5pbXBvcnQgQXBpVXNlciA9IGRiLlVzZXJcbmltcG9ydCBBcGlTY2hlZHVsZXIgPSBkYi5TY2hlZHVsZXJcbmltcG9ydCBBcGlTY2hlZHVsZSA9IGRiLlNjaGVkdWxlXG5pbXBvcnQgQXBpUmVzZXJ2YXRpb24gPSBkYi5SZXNlcnZhdGlvblxuaW1wb3J0IEFwaU9iamVjdElEID0gZGIuT2JqZWN0SURcbmltcG9ydCBBcGlTZWFyY2ggPSBkYi5TZWFyY2hcbmltcG9ydCB7XG4gICAgTW9uZ29FcnJvcixcbiAgICBEZWxldGVXcml0ZU9wUmVzdWx0T2JqZWN0LFxuICAgIE9iamVjdElEIGFzIE1vbmdvT2JqZWN0SUQsXG4gICAgSW5zZXJ0T25lV3JpdGVPcFJlc3VsdCxcbiAgICBPYmplY3RJRFxufSBmcm9tICdtb25nb2RiJztcbmltcG9ydCB7IFJTQV9OT19QQURESU5HIH0gZnJvbSAnY29uc3RhbnRzJztcblxuY29uc3QgT0sgPSAyMDBcbmNvbnN0IEJhZFJlcXVlc3QgPSA0MDBcbmNvbnN0IEludGVybmFsU2VydmVyRXJyb3IgPSA1MDBcblxuY29uc3QgaW5zcGVjdCA9IChpbnB1dDogYW55KSA9PiB1dGlsLmluc3BlY3QoaW5wdXQsIGZhbHNlLCBJbmZpbml0eSwgdHJ1ZSlcblxuaW50ZXJmYWNlIENsYWltQXBwb2ludG1lbnRQYXlsb2FkIHtcbiAgICBjbGFpbWFwcG9pbnRtZW50OiBzd2FnZ2VyVG9vbHMuU3dhZ2dlclJlcXVlc3RQYXJhbWV0ZXI8QXBpUmVzZXJ2YXRpb24gJiBBcGlTY2hlZHVsZSAmIEFwaVVzZXI+IFxuICAgIFtwYXJhbU5hbWU6IHN0cmluZ106IHN3YWdnZXJUb29scy5Td2FnZ2VyUmVxdWVzdFBhcmFtZXRlcjxBcGlSZXNlcnZhdGlvbiAmIEFwaVNjaGVkdWxlICYgQXBpVXNlcj4gfCB1bmRlZmluZWQ7XG59XG5cbmludGVyZmFjZSBVc2VyRWRpdEluZm9QYXlsb2FkIHtcbiAgICB1c2VyOiBzd2FnZ2VyVG9vbHMuU3dhZ2dlclJlcXVlc3RQYXJhbWV0ZXI8QXBpVXNlciAmIEFwaU9iamVjdElEPlxuICAgIFtwYXJhbU5hbWU6IHN0cmluZ106IHN3YWdnZXJUb29scy5Td2FnZ2VyUmVxdWVzdFBhcmFtZXRlcjxBcGlVc2VyICYgQXBpT2JqZWN0SUQ+IHwgdW5kZWZpbmVkO1xufVxuXG5pbnRlcmZhY2UgU2NoZWR1bGVyRWRpdEluZm9QYXlsb2FkIHtcbiAgICBzY2hlZHVsZXI6IHN3YWdnZXJUb29scy5Td2FnZ2VyUmVxdWVzdFBhcmFtZXRlcjxBcGlTY2hlZHVsZXIgJiBBcGlPYmplY3RJRD5cbiAgICBbcGFyYW1OYW1lOiBzdHJpbmddOiBzd2FnZ2VyVG9vbHMuU3dhZ2dlclJlcXVlc3RQYXJhbWV0ZXI8QXBpU2NoZWR1bGVyICYgQXBpT2JqZWN0SUQ+IHwgdW5kZWZpbmVkO1xufVxuXG5pbnRlcmZhY2UgTGlzdG15U2NoZWR1bGVzUGF5bG9hZCB7XG4gICAgc2VhcmNoSW5mbzogc3dhZ2dlclRvb2xzLlN3YWdnZXJSZXF1ZXN0UGFyYW1ldGVyPEFwaVNlYXJjaD5cbiAgICBbcGFyYW1OYW1lOiBzdHJpbmddOiBzd2FnZ2VyVG9vbHMuU3dhZ2dlclJlcXVlc3RQYXJhbWV0ZXI8QXBpU2VhcmNoPiB8IHVuZGVmaW5lZDtcbn1cblxuaW50ZXJmYWNlIExpc3RTY2hlZHVsZXNQYXlsb2FkIHtcbiAgICBsaXN0OiBzd2FnZ2VyVG9vbHMuU3dhZ2dlclJlcXVlc3RQYXJhbWV0ZXI8QXBpU2NoZWR1bGVyPlxuICAgIFtwYXJhbU5hbWU6IHN0cmluZ106IHN3YWdnZXJUb29scy5Td2FnZ2VyUmVxdWVzdFBhcmFtZXRlcjxBcGlTY2hlZHVsZXI+IHwgdW5kZWZpbmVkO1xufVxuXG5pbnRlcmZhY2UgTGlzdEFwcG9pbnRtZW50c1BheWxvYWQge1xuICAgIHNlYXJjaEluZm86IHN3YWdnZXJUb29scy5Td2FnZ2VyUmVxdWVzdFBhcmFtZXRlcjxBcGlTZWFyY2g+XG4gICAgW3BhcmFtTmFtZTogc3RyaW5nXTogc3dhZ2dlclRvb2xzLlN3YWdnZXJSZXF1ZXN0UGFyYW1ldGVyPEFwaVNlYXJjaD4gfCB1bmRlZmluZWQ7XG59XG5cbmludGVyZmFjZSBMaXN0U2NoZWR1bGVyc1BheWxvYWQge1xuICAgIHNlYXJjaEluZm86IHN3YWdnZXJUb29scy5Td2FnZ2VyUmVxdWVzdFBhcmFtZXRlcjxBcGlTZWFyY2g+XG4gICAgW3BhcmFtTmFtZTogc3RyaW5nXTogc3dhZ2dlclRvb2xzLlN3YWdnZXJSZXF1ZXN0UGFyYW1ldGVyPEFwaVNlYXJjaD4gfCB1bmRlZmluZWQ7XG59XG5cblxubW9kdWxlLmV4cG9ydHMuQ2xhaW1BcHBvaW50bWVudCA9IGZ1bmN0aW9uIChyZXE6IGFwaS5SZXF1ZXN0ICYgc3dhZ2dlclRvb2xzLlN3YWdnZXIyMFJlcXVlc3Q8Q2xhaW1BcHBvaW50bWVudFBheWxvYWQ+LCByZXM6IGV4cHJlc3MuUmVzcG9uc2UpIHtcbiAgICBcbiAgICBjb25zb2xlLmxvZyh1dGlsLmluc3BlY3QocmVxLnN3YWdnZXIucGFyYW1zLCBmYWxzZSwgSW5maW5pdHksIHRydWUpKVxuICAgIHJlcy5zZXRIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJylcblxuICAgIHZhciBjbGFpbWFwcG9pbnRtZW50T2JqZWN0ID0gcmVxLnN3YWdnZXIucGFyYW1zLmNsYWltYXBwb2ludG1lbnQudmFsdWU7XG5cbiAgICBpZiAoIXJlcS5zZXNzaW9uKSB7XG4gICAgICAgIHJlcy5zdGF0dXMoQmFkUmVxdWVzdClcbiAgICAgICAgcmVzLnNlbmQoSlNPTi5zdHJpbmdpZnkoeyBtZXNzYWdlOiBcIkludmFsaWQgc2Vzc2lvblwiIH0sIG51bGwsIDIpKVxuICAgICAgICByZXMuZW5kKClcbiAgICB9XG4gICAgaWYgKCFyZXEuc2Vzc2lvbi5lbWFpbCkge1xuICAgICAgICByZXMuc3RhdHVzKEJhZFJlcXVlc3QpXG4gICAgICAgIHJlcy5zZW5kKEpTT04uc3RyaW5naWZ5KHsgbWVzc2FnZTogXCJMb2dpbiByZXF1aXJlZFwifSwgbnVsbCwgMikpXG4gICAgICAgIHJlcy5lbmQoKVxuICAgIH1cbiAgICBkYi5TY2hlZHVsZS5maW5kT25lKHsgX2lkOiBuZXcgTW9uZ29PYmplY3RJRChjbGFpbWFwcG9pbnRtZW50T2JqZWN0LnNfaWQpIH0sIGZ1bmN0aW9uIChlcnI6IE1vbmdvRXJyb3IsIHJlc3VsdDogQXBpU2NoZWR1bGUgfCBudWxsKSB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoSW50ZXJuYWxTZXJ2ZXJFcnJvcilcbiAgICAgICAgICAgIHJlcy5zZW5kKEpTT04uc3RyaW5naWZ5KHsgbWVzc2FnZTogaW5zcGVjdChlcnIpIH0sIG51bGwsIDIpKVxuICAgICAgICAgICAgcmVzLmVuZCgpXG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFyZXN1bHQpICB7XG4gICAgICAgICAgICByZXMuc3RhdHVzKEJhZFJlcXVlc3QpXG4gICAgICAgICAgICByZXMuc2VuZChKU09OLnN0cmluZ2lmeSh7IG1lc3NhZ2dlOiBcIlNjaGVkdWxlIERvZXNuJ3QgZXhpc3RcIiB9LCBudWxsLCAyKSlcbiAgICAgICAgICAgIHJlcy5lbmQoKVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGRiLlJlc2VydmF0aW9uLmluc2VydE9uZShjbGFpbWFwcG9pbnRtZW50T2JqZWN0LCBmdW5jdGlvbiAoZXJyOiBNb25nb0Vycm9yLCByZXN1bHQ6IEluc2VydE9uZVdyaXRlT3BSZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzLnN0YXR1cyhJbnRlcm5hbFNlcnZlckVycm9yKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzLnNlbmQoSlNPTi5zdHJpbmdpZnkoeyBtZXNzYWdlOiBpbnNwZWN0KGVycikgfSwgbnVsbCwgMikpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXMuZW5kKClcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzLnN0YXR1cyhCYWRSZXF1ZXN0KVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzLnNlbmQoSlNPTi5zdHJpbmdpZnkoeyBtZXNzYWdlOiBcIkNsYWltIEFwcG9pbnRtZW50IEZ1bmN0aW9uIEZhaWxlZFwiIH0sIG51bGwsIDIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzLmVuZCgpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXMuc3RhdHVzKE9LKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzLnNlbmQoSlNPTi5zdHJpbmdpZnkoeyBtZXNzYWdlOiBcIkNsYWltZWQgQXBwb2ludG1lbnQgU3VjY2VzZnVsbHlcIiB9LCBudWxsLCAyKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcy5lbmQoKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICkgXG59O1xuXG5tb2R1bGUuZXhwb3J0cy5MaXN0bXlTY2hlZHVsZXMgPSBmdW5jdGlvbiAocmVxOiBhcGkuUmVxdWVzdCAmIHN3YWdnZXJUb29scy5Td2FnZ2VyMjBSZXF1ZXN0PExpc3RteVNjaGVkdWxlc1BheWxvYWQ+LCByZXM6IGV4cHJlc3MuUmVzcG9uc2UpIHtcblxuICAgIGNvbnNvbGUubG9nKHV0aWwuaW5zcGVjdChyZXEuc3dhZ2dlci5wYXJhbXMsIGZhbHNlLCBJbmZpbml0eSwgdHJ1ZSkpXG5cbiAgICByZXMuc2V0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpXG5cbiAgICBpZiAoIXJlcS5zZXNzaW9uKSB7XG4gICAgICAgIHJldHVyblxuICAgIH1cbiAgICBcbiAgICBkYi5TY2hlZHVsZS5maW5kKHtcbiAgICAgICAgc2NoZWR1bGVySUQ6IG5ldyBPYmplY3RJRChyZXEuc2Vzc2lvbi5sb2dpZClcbiAgICB9KS50b0FycmF5KCkudGhlbigoZGF0YSkgPT4ge1xuICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgcmVzLnN0YXR1cyhPSylcbiAgICAgICAgICAgIHJlcy5zZW5kKEpTT04uc3RyaW5naWZ5KGRhdGEpKVxuICAgICAgICAgICAgcmVzLmVuZCgpXG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXMuc3RhdHVzKE9LKVxuICAgICAgICAgICAgcmVzLnNlbmQoSlNPTi5zdHJpbmdpZnkoW10sIG51bGwsIDIpKVxuICAgICAgICAgICAgcmVzLmVuZCgpXG4gICAgICAgIH1cbiAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIHJlcy5zdGF0dXMoSW50ZXJuYWxTZXJ2ZXJFcnJvcilcbiAgICAgICAgcmVzLnNlbmQoSlNPTi5zdHJpbmdpZnkoeyBtZXNzYWdlOiBpbnNwZWN0KGVycikgfSwgbnVsbCwgMikpXG4gICAgICAgIHJlcy5lbmQoKVxuICAgIH0pXG59O1xuXG5tb2R1bGUuZXhwb3J0cy5MaXN0U2NoZWR1bGVzID0gZnVuY3Rpb24gKHJlcTogYXBpLlJlcXVlc3QgJiBzd2FnZ2VyVG9vbHMuU3dhZ2dlcjIwUmVxdWVzdDxMaXN0U2NoZWR1bGVzUGF5bG9hZD4sIHJlczogZXhwcmVzcy5SZXNwb25zZSkge1xuICAgIGNvbnNvbGUubG9nKHV0aWwuaW5zcGVjdChyZXEuc3dhZ2dlci5wYXJhbXMsIGZhbHNlLCBJbmZpbml0eSwgdHJ1ZSkpXG5cbiAgICByZXMuc2V0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpXG5cbiAgICBpZiAoIXJlcS5zZXNzaW9uKSB7XG4gICAgICAgIHJldHVyblxuICAgIH1cbiAgICBcbiAgICBkYi5TY2hlZHVsZS5maW5kKHtcbiAgICAgICAgc2NoZWR1bGVySUQ6IG5ldyBPYmplY3RJRChyZXEuc3dhZ2dlci5wYXJhbXMubGlzdC52YWx1ZS5zY2hlZHVsZXJJRClcbiAgICB9KS50b0FycmF5KCkudGhlbigoZGF0YSkgPT4ge1xuICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgcmVzLnN0YXR1cyhPSylcbiAgICAgICAgICAgIHJlcy5zZW5kKEpTT04uc3RyaW5naWZ5KGRhdGEpKVxuICAgICAgICAgICAgcmVzLmVuZCgpXG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXMuc3RhdHVzKE9LKVxuICAgICAgICAgICAgcmVzLnNlbmQoSlNPTi5zdHJpbmdpZnkoW10sIG51bGwsIDIpKVxuICAgICAgICAgICAgcmVzLmVuZCgpXG4gICAgICAgIH1cbiAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIHJlcy5zdGF0dXMoSW50ZXJuYWxTZXJ2ZXJFcnJvcilcbiAgICAgICAgcmVzLnNlbmQoSlNPTi5zdHJpbmdpZnkoeyBtZXNzYWdlOiBpbnNwZWN0KGVycikgfSwgbnVsbCwgMikpXG4gICAgICAgIHJlcy5lbmQoKVxuICAgIH0pXG59O1xuXG5tb2R1bGUuZXhwb3J0cy5TY2hlZHVsZXJFZGl0SW5mbyA9IGZ1bmN0aW9uIChyZXE6IGFwaS5SZXF1ZXN0ICYgc3dhZ2dlclRvb2xzLlN3YWdnZXIyMFJlcXVlc3Q8U2NoZWR1bGVyRWRpdEluZm9QYXlsb2FkPiwgcmVzOiBleHByZXNzLlJlc3BvbnNlKSB7XG4gICAgXG4gICAgY29uc29sZS5sb2codXRpbC5pbnNwZWN0KHJlcS5zd2FnZ2VyLnBhcmFtcywgZmFsc2UsIEluZmluaXR5LCB0cnVlKSlcbiAgICByZXMuc2V0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpXG5cbiAgICBpZiAocmVxLnNlc3Npb24gJiYgcmVxLnNlc3Npb24ubG9naWQpIHtcbiAgICAgICAgZGIuU2NoZWR1bGVyLmZpbmQoe1xuICAgICAgICAgICAgX2lkOiBuZXcgT2JqZWN0SUQocmVxLnN3YWdnZXIucGFyYW1zLnNjaGVkdWxlci52YWx1ZS5faWQpXG4gICAgICAgIH0pLnRvQXJyYXkoKS50aGVuKChkYXRhKSA9PiB7XG4gICAgICAgICAgICBpZiAoZGF0YS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBpZiAoZGF0YVswXS5zY2hlZHVsZXJJRC5lcXVhbHMobmV3IE9iamVjdElEKHJlcS5zZXNzaW9uLmxvZ2lkKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgZGIuU2NoZWR1bGVyLnJlcGxhY2VPbmUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgX2lkOiBuZXcgT2JqZWN0SUQocmVxLnN3YWdnZXIucGFyYW1zLnNjaGVkdWxlci52YWx1ZS5faWQpXG4gICAgICAgICAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2hlZHVsZXJJRDogZGF0YVswXS5zY2hlZHVsZXJJRCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBncm91cDogcmVxLnN3YWdnZXIucGFyYW1zLnNjaGVkdWxlci52YWx1ZS5ncm91cCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWFpbDogcmVxLnN3YWdnZXIucGFyYW1zLnNjaGVkdWxlci52YWx1ZS5lbWFpbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzd29yZDogcmVxLnN3YWdnZXIucGFyYW1zLnNjaGVkdWxlci52YWx1ZS5wYXNzd29yZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLnRoZW4odXBkYXRlV3JpdGVPcFJlc3VsdCA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzLnN0YXR1cyhPSylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXMuc2VuZChKU09OLnN0cmluZ2lmeSh7IG1lc3NhZ2U6IFwiVXBkYXRlIHN1Y2Nlc3NmdWwhXCIgfSwgbnVsbCwgMikpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzLmVuZCgpXG4gICAgICAgICAgICAgICAgICAgICAgICB9KS5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcy5zdGF0dXMoSW50ZXJuYWxTZXJ2ZXJFcnJvcilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXMuc2VuZChKU09OLnN0cmluZ2lmeSh7IG1lc3NhZ2U6IGluc3BlY3QoZXJyKSB9LCBudWxsLCAyKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXMuZW5kKClcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXMuc3RhdHVzKEJhZFJlcXVlc3QpXG4gICAgICAgICAgICAgICAgICAgIHJlcy5zZW5kKEpTT04uc3RyaW5naWZ5KHsgbWVzc2FnZTogYENvdWxkIG5vdCB1cGRhdGUgaW5mbyAke3JlcS5zZXNzaW9uLmVtYWlsfToke3JlcS5zZXNzaW9uLmxvZ2lkfWAgfSwgbnVsbCwgMikpXG4gICAgICAgICAgICAgICAgICAgIHJlcy5lbmQoKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlcy5zdGF0dXMoQmFkUmVxdWVzdClcbiAgICAgICAgICAgICAgICByZXMuc2VuZChKU09OLnN0cmluZ2lmeSh7IG1lc3NhZ2U6IGBUaGlzIHNjaGVkdWxlciBkb2VzIG5vdCBleGlzdDogJHtyZXEuc3dhZ2dlci5wYXJhbXMuc2NoZWR1bGVyLnZhbHVlLl9pZH1gIH0sIG51bGwsIDIpKVxuICAgICAgICAgICAgICAgIHJlcy5lbmQoKVxuICAgICAgICAgICAgfVxuICAgICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICByZXMuc3RhdHVzKEludGVybmFsU2VydmVyRXJyb3IpXG4gICAgICAgICAgICByZXMuc2VuZChKU09OLnN0cmluZ2lmeSh7IG1lc3NhZ2U6IGluc3BlY3QoZXJyKSB9LCBudWxsLCAyKSlcbiAgICAgICAgICAgIHJlcy5lbmQoKVxuICAgICAgICB9KVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmVzLnN0YXR1cyhCYWRSZXF1ZXN0KVxuICAgICAgICByZXMuc2VuZChKU09OLnN0cmluZ2lmeSh7IG1lc3NhZ2U6IFwiWW91IG11c3QgYmUgbG9nZ2VkIGluIHRvIHVzZSB0aGlzIGZlYXR1cmUuXCIgfSwgbnVsbCwgMikpXG4gICAgICAgIHJlcy5lbmQoKVxuICAgIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzLlVzZXJFZGl0SW5mbyA9IGZ1bmN0aW9uIChyZXE6IGFwaS5SZXF1ZXN0ICYgc3dhZ2dlclRvb2xzLlN3YWdnZXIyMFJlcXVlc3Q8VXNlckVkaXRJbmZvUGF5bG9hZD4sIHJlczogZXhwcmVzcy5SZXNwb25zZSkge1xuICAgIFxuICAgIGNvbnNvbGUubG9nKHV0aWwuaW5zcGVjdChyZXEuc3dhZ2dlci5wYXJhbXMsIGZhbHNlLCBJbmZpbml0eSwgdHJ1ZSkpXG4gICAgcmVzLnNldEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKVxuXG4gICAgaWYgKHJlcS5zZXNzaW9uICYmIHJlcS5zZXNzaW9uLmxvZ2lkKSB7XG4gICAgICAgIGRiLlVzZXIuZmluZCh7XG4gICAgICAgICAgICBfaWQ6IG5ldyBPYmplY3RJRChyZXEuc3dhZ2dlci5wYXJhbXMudXNlci52YWx1ZS5faWQpXG4gICAgICAgIH0pLnRvQXJyYXkoKS50aGVuKChkYXRhKSA9PiB7XG4gICAgICAgICAgICBpZiAoZGF0YS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBpZiAoZGF0YVswXS5faWQuZXF1YWxzKG5ldyBPYmplY3RJRChyZXEuc2Vzc2lvbi5sb2dpZCkpKSB7XG4gICAgICAgICAgICAgICAgICAgIGRiLlVzZXIucmVwbGFjZU9uZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBfaWQ6IG5ldyBPYmplY3RJRChyZXEuc3dhZ2dlci5wYXJhbXMudXNlci52YWx1ZS5faWQpXG4gICAgICAgICAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfaWQ6IGRhdGFbMF0uX2lkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0bmFtZTogcmVxLnN3YWdnZXIucGFyYW1zLnVzZXIudmFsdWUuZmlyc3RuYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RuYW1lOiByZXEuc3dhZ2dlci5wYXJhbXMudXNlci52YWx1ZS5sYXN0bmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWFpbDogcmVxLnN3YWdnZXIucGFyYW1zLnVzZXIudmFsdWUuZW1haWwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHJlcS5zd2FnZ2VyLnBhcmFtcy51c2VyLnZhbHVlLnBhc3N3b3JkLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSkudGhlbih1cGRhdGVXcml0ZU9wUmVzdWx0ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXMuc3RhdHVzKE9LKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcy5zZW5kKEpTT04uc3RyaW5naWZ5KHsgbWVzc2FnZTogXCJVcGRhdGUgc3VjY2Vzc2Z1bCFcIiB9LCBudWxsLCAyKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXMuZW5kKClcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKGVyciA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzLnN0YXR1cyhJbnRlcm5hbFNlcnZlckVycm9yKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcy5zZW5kKEpTT04uc3RyaW5naWZ5KHsgbWVzc2FnZTogaW5zcGVjdChlcnIpIH0sIG51bGwsIDIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcy5lbmQoKVxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlcy5zdGF0dXMoQmFkUmVxdWVzdClcbiAgICAgICAgICAgICAgICAgICAgcmVzLnNlbmQoSlNPTi5zdHJpbmdpZnkoeyBtZXNzYWdlOiBgQ291bGQgbm90IHVwZGF0ZSBpbmZvICR7cmVxLnNlc3Npb24uZW1haWx9OiR7cmVxLnNlc3Npb24ubG9naWR9YCB9LCBudWxsLCAyKSlcbiAgICAgICAgICAgICAgICAgICAgcmVzLmVuZCgpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzLnN0YXR1cyhCYWRSZXF1ZXN0KVxuICAgICAgICAgICAgICAgIHJlcy5zZW5kKEpTT04uc3RyaW5naWZ5KHsgbWVzc2FnZTogYFRoaXMgdXNlciBkb2VzIG5vdCBleGlzdDogJHtyZXEuc3dhZ2dlci5wYXJhbXMudXNlci52YWx1ZS5faWR9YCB9LCBudWxsLCAyKSlcbiAgICAgICAgICAgICAgICByZXMuZW5kKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgcmVzLnN0YXR1cyhJbnRlcm5hbFNlcnZlckVycm9yKVxuICAgICAgICAgICAgcmVzLnNlbmQoSlNPTi5zdHJpbmdpZnkoeyBtZXNzYWdlOiBpbnNwZWN0KGVycikgfSwgbnVsbCwgMikpXG4gICAgICAgICAgICByZXMuZW5kKClcbiAgICAgICAgfSlcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJlcy5zdGF0dXMoQmFkUmVxdWVzdClcbiAgICAgICAgcmVzLnNlbmQoSlNPTi5zdHJpbmdpZnkoeyBtZXNzYWdlOiBcIllvdSBtdXN0IGJlIGxvZ2dlZCBpbiB0byB1c2UgdGhpcyBmZWF0dXJlLlwiIH0sIG51bGwsIDIpKVxuICAgICAgICByZXMuZW5kKClcbiAgICB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cy5MaXN0QXBwb2ludG1lbnRzID0gZnVuY3Rpb24gKHJlcTogYXBpLlJlcXVlc3QgJiBzd2FnZ2VyVG9vbHMuU3dhZ2dlcjIwUmVxdWVzdDxMaXN0QXBwb2ludG1lbnRzUGF5bG9hZD4sIHJlczogZXhwcmVzcy5SZXNwb25zZSkge1xuXG4gICAgY29uc29sZS5sb2codXRpbC5pbnNwZWN0KHJlcS5zd2FnZ2VyLnBhcmFtcywgZmFsc2UsIEluZmluaXR5LCB0cnVlKSlcblxuICAgIHJlcy5zZXRIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJylcblxuICAgIGlmICghcmVxLnNlc3Npb24pIHtcbiAgICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgZGIuUmVzZXJ2YXRpb24uZmluZCh7XG4gICAgICAgICAgICBVc2VySUQ6IG5ldyBPYmplY3RJRChyZXEuc2Vzc2lvbi5sb2dpZClcbiAgICAgICAgfSkudG9BcnJheSgpLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgXG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJlcy5zdGF0dXMoT0spXG4gICAgICAgICAgICAgICAgcmVzLnNlbmQoSlNPTi5zdHJpbmdpZnkoZGF0YSkpXG4gICAgICAgICAgICAgICAgcmVzLmVuZCgpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXMuc3RhdHVzKE9LKVxuICAgICAgICAgICAgICAgIHJlcy5zZW5kKEpTT04uc3RyaW5naWZ5KFtdLCBudWxsLCAyKSlcbiAgICAgICAgICAgICAgICByZXMuZW5kKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICByZXMuc3RhdHVzKEludGVybmFsU2VydmVyRXJyb3IpXG4gICAgICAgICAgICByZXMuc2VuZChKU09OLnN0cmluZ2lmeSh7IG1lc3NhZ2U6IGluc3BlY3QoZXJyKSB9LCBudWxsLCAyKSlcbiAgICAgICAgICAgIHJlcy5lbmQoKVxuICAgICAgICB9KVxufTtcblxubW9kdWxlLmV4cG9ydHMuTGlzdFNjaGVkdWxlcnMgPSBmdW5jdGlvbiAocmVxOiBhcGkuUmVxdWVzdCAmIHN3YWdnZXJUb29scy5Td2FnZ2VyMjBSZXF1ZXN0PExpc3RTY2hlZHVsZXJzUGF5bG9hZD4sIHJlczogZXhwcmVzcy5SZXNwb25zZSkge1xuICAgIGNvbnNvbGUubG9nKHV0aWwuaW5zcGVjdChyZXEuc3dhZ2dlci5wYXJhbXMsIGZhbHNlLCBJbmZpbml0eSwgdHJ1ZSkpXG5cbiAgICByZXMuc2V0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpXG4gICAgaWYgKCFyZXEuc2Vzc2lvbikge1xuICAgICAgICByZXR1cm5cbiAgICB9XG4gICAgZGIuU2NoZWR1bGVyLmZpbmQoe30pLnRvQXJyYXkoKS50aGVuKChkYXRhKSA9PiB7XG4gXG4gICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICByZXMuc3RhdHVzKE9LKVxuICAgICAgICAgICAgcmVzLnNlbmQoSlNPTi5zdHJpbmdpZnkoZGF0YSkpXG4gICAgICAgICAgICByZXMuZW5kKClcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoT0spXG4gICAgICAgICAgICByZXMuc2VuZChKU09OLnN0cmluZ2lmeShbXSwgbnVsbCwgMikpXG4gICAgICAgICAgICByZXMuZW5kKClcbiAgICAgICAgfVxuICAgICAgICBcbiAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIHJlcy5zdGF0dXMoSW50ZXJuYWxTZXJ2ZXJFcnJvcilcbiAgICAgICAgcmVzLnNlbmQoSlNPTi5zdHJpbmdpZnkoeyBtZXNzYWdlOiBpbnNwZWN0KGVycikgfSwgbnVsbCwgMikpXG4gICAgICAgIHJlcy5lbmQoKVxuICAgIH0pXG59O1xuIl19
