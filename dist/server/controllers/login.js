'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
const util = require("util");
const db = require("../db");
const OK = 200;
const BadRequest = 400;
const InternalServerError = 500;
const inspect = (input) => util.inspect(input, false, Infinity, true);
module.exports.SchedulerSignup = function (req, res, next) {
    // print out the params
    console.log(inspect(req.swagger.params));
    res.setHeader('Content-Type', 'application/json');
    // These should always be filled out because of the swagger validation, but we should still
    // probably check them.
    if (req.swagger.params.schedulerinfo.value.group && req.swagger.params.schedulerinfo.value.email && req.swagger.params.schedulerinfo.value.password) {
        db.Scheduler.findOne({ 'email': req.swagger.params.schedulerinfo.value.email }).then((scheduler) => {
            if (scheduler) {
                res.status(BadRequest);
                res.send(JSON.stringify({ message: `Email ${req.swagger.params.schedulerinfo.value.email} is already in use.` }, null, 2));
                res.end();
            }
            else {
                var bcrypt = require('bcryptjs');
                var salt = bcrypt.genSaltSync(10);
                var hash = bcrypt.hashSync(req.swagger.params.schedulerinfo.value.password, salt);
                req.swagger.params.schedulerinfo.value.password = hash;
                db.Scheduler.insertOne(req.swagger.params.schedulerinfo.value).then((writeOpResult) => {
                    if (req.session) {
                        req.session.email = req.swagger.params.schedulerinfo.value.email;
                        req.session.logid = writeOpResult.insertedId.toHexString();
                        req.session.type = "Scheduler";
                    }
                    res.status(OK);
                    res.send(JSON.stringify({ message: "It worked!" }, null, 2));
                    res.end();
                }).catch((err) => {
                    res.status(InternalServerError);
                    res.send(JSON.stringify({ message: inspect(err) }, null, 2));
                    res.end();
                });
            }
        }).catch((err) => {
            res.status(InternalServerError);
            res.send(JSON.stringify({ message: inspect(err) }, null, 2));
            res.end();
        });
    }
    else {
        res.status(BadRequest);
        res.send(JSON.stringify({ message: "Name, Email, and password are required" }, null, 2));
        res.end();
    }
};
module.exports.SchedulerLogin = function (req, res, next) {
    // print out the params
    console.log(inspect(req.swagger.params));
    res.setHeader('Content-Type', 'application/json');
    // These should always be filled out because of the swagger validation, but we should still
    // probably check them.
    if (req.swagger.params.schedulerinfo.value.email && req.swagger.params.schedulerinfo.value.password) {
        db.Scheduler.findOne({ 'email': req.swagger.params.schedulerinfo.value.email }).then((scheduler) => {
            var bcrypt = require('bcryptjs');
            if (scheduler != null) {
                var hash = scheduler.password;
                var success = bcrypt.compare(req.swagger.params.schedulerinfo.value.password, hash);
                if (success) {
                    req.swagger.params.schedulerinfo.value.password = hash;
                }
            }
            db.Scheduler.findOne(req.swagger.params.schedulerinfo.value).then((scheduler) => {
                if (scheduler) {
                    if (req.session) {
                        req.session.email = req.swagger.params.schedulerinfo.value.email;
                        req.session.logid = scheduler.schedulerID;
                        req.session.type = "Scheduler";
                    }
                    res.status(OK);
                    res.send(JSON.stringify({ message: "It worked!" }, null, 2));
                    res.end();
                }
                else {
                    res.status(BadRequest);
                    res.send(JSON.stringify({ message: "Email and password did not match any known user, your hash is: " }, null, 2));
                    res.end();
                }
            }).catch((err) => {
                res.status(InternalServerError);
                res.send(JSON.stringify({ message: inspect(err) }, null, 2));
                res.end();
            });
        }).catch((err) => {
            res.status(InternalServerError);
            res.send(JSON.stringify({ message: inspect(err) }, null, 2));
            res.end();
        });
    }
    else {
        res.status(BadRequest);
        res.send(JSON.stringify({ message: "Email and password are required" }, null, 2));
        res.end();
    }
};
module.exports.UserSignup = function (req, res, next) {
    // print out the params
    console.log(inspect(req.swagger.params));
    res.setHeader('Content-Type', 'application/json');
    // These should always be filled out because of the swagger validation, but we should still
    // probably check them.
    if (req.swagger.params.userinfo.value.firstname && req.swagger.params.userinfo.value.lastname && req.swagger.params.userinfo.value.email && req.swagger.params.userinfo.value.password) {
        db.User.findOne({ 'email': req.swagger.params.userinfo.value.email }).then((user) => {
            if (user) {
                res.status(BadRequest);
                res.send(JSON.stringify({ message: `Email ${req.swagger.params.userinfo.value.email} is already in use.` }, null, 2));
                res.end();
            }
            else {
                var bcrypt = require('bcryptjs');
                var salt = bcrypt.genSaltSync(10);
                var hash = bcrypt.hashSync(req.swagger.params.userinfo.value.password, salt);
                req.swagger.params.userinfo.value.password = hash;
                db.User.insertOne(req.swagger.params.userinfo.value).then((writeOpResult) => {
                    if (req.session) {
                        req.session.email = req.swagger.params.userinfo.value.email;
                        req.session.logid = writeOpResult.insertedId.toHexString();
                        req.session.type = "User";
                    }
                    res.status(OK);
                    res.send(JSON.stringify({ message: "It worked!" }, null, 2));
                    res.end();
                }).catch((err) => {
                    res.status(InternalServerError);
                    res.send(JSON.stringify({ message: inspect(err) }, null, 2));
                    res.end();
                });
            }
        }).catch((err) => {
            res.status(InternalServerError);
            res.send(JSON.stringify({ message: inspect(err) }, null, 2));
            res.end();
        });
    }
    else {
        res.status(BadRequest);
        res.send(JSON.stringify({ message: "Name, email, and password are required" }, null, 2));
        res.end();
    }
};
module.exports.UserLogin = function (req, res, next) {
    // print out the params
    console.log(inspect(req.swagger.params));
    res.setHeader('Content-Type', 'application/json');
    // These should always be filled out because of the swagger validation, but we should still
    // probably check them.
    if (req.swagger.params.userinfo.value.email && req.swagger.params.userinfo.value.password) {
        db.User.findOne({ 'email': req.swagger.params.userinfo.value.email }).then((user) => {
            var bcrypt = require('bcryptjs');
            if (user != null) {
                var hash = user.password;
                var success = bcrypt.compare(req.swagger.params.userinfo.value.password, hash);
                if (success) {
                    req.swagger.params.userinfo.value.password = hash;
                }
            }
            db.User.findOne(req.swagger.params.userinfo.value).then((user) => {
                if (user) {
                    if (req.session) {
                        req.session.email = req.swagger.params.userinfo.value.email;
                        req.session.userid = user._id;
                        req.session.type = "User";
                    }
                    res.status(OK);
                    res.send(JSON.stringify({ message: "It worked!" }, null, 2));
                    res.end();
                }
                else {
                    res.status(BadRequest);
                    res.send(JSON.stringify({ message: "Email and password did not match any known user, your hash is: " }, null, 2));
                    res.end();
                }
            }).catch((err) => {
                res.status(InternalServerError);
                res.send(JSON.stringify({ message: inspect(err) }, null, 2));
                res.end();
            });
        }).catch((err) => {
            res.status(InternalServerError);
            res.send(JSON.stringify({ message: inspect(err) }, null, 2));
            res.end();
        });
    }
    else {
        res.status(BadRequest);
        res.send(JSON.stringify({ message: "Email and password are required" }, null, 2));
        res.end();
    }
};
module.exports.UserLogout = function (req, res, next) {
    // print out the params
    console.log(util.inspect(req.swagger.params, false, Infinity, true));
    let email, logid;
    if (req.session) {
        email = req.session.email;
        logid = req.session.logid;
        delete req.session.logid;
        delete req.session.email;
        delete req.session.type;
    }
    res.setHeader('Content-Type', 'application/json');
    res.status(OK);
    res.send(JSON.stringify({ message: `Logged out user: ${email} ${logid}` }, null, 2));
    res.end();
};
module.exports.SchedulerLogout = function (req, res, next) {
    // print out the params
    console.log(util.inspect(req.swagger.params, false, Infinity, true));
    let email, logid;
    if (req.session) {
        email = req.session.email;
        logid = req.session.logid;
        delete req.session.email;
        delete req.session.logid;
        delete req.session.type;
    }
    res.setHeader('Content-Type', 'application/json');
    res.status(OK);
    res.send(JSON.stringify({ message: `Logged out scheduler: ${email} ${logid}` }, null, 2));
    res.end();
};

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9zZXJ2ZXIvY29udHJvbGxlcnMvbG9naW4udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDOztBQUViLDZCQUE2QjtBQUU3Qiw0QkFBNEI7QUFJNUIsTUFBTSxFQUFFLEdBQUcsR0FBRyxDQUFBO0FBQ2QsTUFBTSxVQUFVLEdBQUcsR0FBRyxDQUFBO0FBQ3RCLE1BQU0sbUJBQW1CLEdBQUcsR0FBRyxDQUFBO0FBRS9CLE1BQU0sT0FBTyxHQUFHLENBQUMsS0FBVSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLElBQUksQ0FBQyxDQUFBO0FBYTFFLE1BQU0sQ0FBQyxPQUFPLENBQUMsZUFBZSxHQUFHLFVBQVUsR0FBd0UsRUFBRSxHQUFRLEVBQUUsSUFBUztJQUNwSSx1QkFBdUI7SUFDdkIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFBO0lBQ3hDLEdBQUcsQ0FBQyxTQUFTLENBQUMsY0FBYyxFQUFFLGtCQUFrQixDQUFDLENBQUE7SUFFakQsMkZBQTJGO0lBQzNGLHVCQUF1QjtJQUN2QixJQUFJLEdBQUcsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsS0FBSyxJQUFHLEdBQUcsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsS0FBSyxJQUFJLEdBQUcsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFO1FBQ2hKLEVBQUUsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLEVBQUUsT0FBTyxFQUFFLEdBQUcsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxTQUFTLEVB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LENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsU0FBUyxJQUFJLEdBQUcsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsUUFBUSxJQUFJLEdBQUcsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsS0FBSyxJQUFJLEdBQUcsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFO1FBQ3BMLEVBQUUsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEVBQUUsT0FBTyxFQUFFLEdBQUcsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRTtZQUNoRixJQUFJLElBQUksRUFBRTtnQkFDTixHQUFHLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFBO2dCQUN0QixHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRSxPQUFPLEVBQUUsU0FBUyxHQUFHLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLEtBQUsscUJBQXFCLEVBQUUsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQTtnQkFDckgsR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFBO2FBQ1o7aUJBQ0k7Z0JBQ0QsSUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDO2dCQUNqQyxJQUFJLElBQUksR0FBRyxNQUFNLENBQUMsV0FBVyxDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUNsQyxJQUFJLElBQUksR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxDQUFDO2dCQUU3RSxHQUFHLENBQUMsT0FBTyxDQUFDLE1B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RSxHQUFRLEVBQUUsSUFBUztJQUNwRSx1QkFBdUI7SUFDdkIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQTtJQUVwRSxJQUFJLEtBQUssRUFBRSxLQUFLLENBQUE7SUFDaEIsSUFBSSxHQUFHLENBQUMsT0FBTyxFQUFFO1FBQ2IsS0FBSyxHQUFHLEdBQUcsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFBO1FBQ3pCLEtBQUssR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQTtRQUN6QixPQUFPLEdBQUcsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFBO1FBQ3hCLE9BQU8sR0FBRyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUE7UUFDeEIsT0FBTyxHQUFHLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQTtLQUMxQjtJQUVELEdBQUcsQ0FBQyxTQUFTLENBQUMsY0FBYyxFQUFFLGtCQUFrQixDQUFDLENBQUE7SUFDakQsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQTtJQUNkLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFLE9BQU8sRUFBRSx5QkFBeUIsS0FBSyxJQUFJLEtBQUssRUFBRSxFQUFFLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUE7SUFDekYsR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFBO0FBQ2IsQ0FBQyxDQUFBIiwiZmlsZSI6InNlcnZlci9jb250cm9sbGVycy9sb2dpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IHV0aWwgPSByZXF1aXJlKCd1dGlsJylcbmltcG9ydCBzd2FnZ2VyVG9vbHMgPSByZXF1aXJlKCdzd2FnZ2VyLXRvb2xzJylcbmltcG9ydCBkYiA9IHJlcXVpcmUoJy4uL2RiJylcbmltcG9ydCBhcGkgPSByZXF1aXJlKCcuLi9hcGknKVxuaW1wb3J0IFVzZXIgPSBkYi5Vc2VyXG5cbmNvbnN0IE9LID0gMjAwXG5jb25zdCBCYWRSZXF1ZXN0ID0gNDAwXG5jb25zdCBJbnRlcm5hbFNlcnZlckVycm9yID0gNTAwXG5cbmNvbnN0IGluc3BlY3QgPSAoaW5wdXQ6IGFueSkgPT4gdXRpbC5pbnNwZWN0KGlucHV0LCBmYWxzZSwgSW5maW5pdHksIHRydWUpXG5cbi8vIE1ha2Ugc3VyZSB0aGlzIG1hdGNoZXMgdGhlIFN3YWdnZXIuanNvbiBib2R5IHBhcmFtZXRlciBmb3IgdGhlIC9zaWdudXAgQVBJXG5pbnRlcmZhY2UgU2lnbnVwUGF5bG9hZCB7XG4gICAgdXNlcmluZm86IHN3YWdnZXJUb29scy5Td2FnZ2VyUmVxdWVzdFBhcmFtZXRlcjxVc2VyPlxuICAgIFtwYXJhbU5hbWU6IHN0cmluZ106IHN3YWdnZXJUb29scy5Td2FnZ2VyUmVxdWVzdFBhcmFtZXRlcjxVc2VyPiB8IHVuZGVmaW5lZDtcbn1cblxuaW50ZXJmYWNlIFNjaGVkdWxlclNpZ251cFBheWxvYWQge1xuICAgIHNjaGVkdWxlcmluZm86IHN3YWdnZXJUb29scy5Td2FnZ2VyUmVxdWVzdFBhcmFtZXRlcjxkYi5TY2hlZHVsZXI+XG4gICAgW3BhcmFtTmFtZTogc3RyaW5nXTogc3dhZ2dlclRvb2xzLlN3YWdnZXJSZXF1ZXN0UGFyYW1ldGVyPGRiLlNjaGVkdWxlcj4gfCB1bmRlZmluZWQ7XG59XG5cbm1vZHVsZS5leHBvcnRzLlNjaGVkdWxlclNpZ251cCA9IGZ1bmN0aW9uIChyZXE6IGFwaS5SZXF1ZXN0ICYgc3dhZ2dlclRvb2xzLlN3YWdnZXIyMFJlcXVlc3Q8U2NoZWR1bGVyU2lnbnVwUGF5bG9hZD4sIHJlczogYW55LCBuZXh0OiBhbnkpIHtcbiAgICAvLyBwcmludCBvdXQgdGhlIHBhcmFtc1xuICAgIGNvbnNvbGUubG9nKGluc3BlY3QocmVxLnN3YWdnZXIucGFyYW1zKSlcbiAgICByZXMuc2V0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpXG5cbiAgICAvLyBUaGVzZSBzaG91bGQgYWx3YXlzIGJlIGZpbGxlZCBvdXQgYmVjYXVzZSBvZiB0aGUgc3dhZ2dlciB2YWxpZGF0aW9uLCBidXQgd2Ugc2hvdWxkIHN0aWxsXG4gICAgLy8gcHJvYmFibHkgY2hlY2sgdGhlbS5cbiAgICBpZiAocmVxLnN3YWdnZXIucGFyYW1zLnNjaGVkdWxlcmluZm8udmFsdWUuZ3JvdXAgJiZyZXEuc3dhZ2dlci5wYXJhbXMuc2NoZWR1bGVyaW5mby52YWx1ZS5lbWFpbCAmJiByZXEuc3dhZ2dlci5wYXJhbXMuc2NoZWR1bGVyaW5mby52YWx1ZS5wYXNzd29yZCkge1xuICAgICAgICBkYi5TY2hlZHVsZXIuZmluZE9uZSh7ICdlbWFpbCc6IHJlcS5zd2FnZ2VyLnBhcmFtcy5zY2hlZHVsZXJpbmZvLnZhbHVlLmVtYWlsIH0pLnRoZW4oKHNjaGVkdWxlcikgPT4ge1xuICAgICAgICAgICAgaWYgKHNjaGVkdWxlcikge1xuICAgICAgICAgICAgICAgIHJlcy5zdGF0dXMoQmFkUmVxdWVzdClcbiAgICAgICAgICAgICAgICByZXMuc2VuZChKU09OLnN0cmluZ2lmeSh7IG1lc3NhZ2U6IGBFbWFpbCAke3JlcS5zd2FnZ2VyLnBhcmFtcy5zY2hlZHVsZXJpbmZvLnZhbHVlLmVtYWlsfSBpcyBhbHJlYWR5IGluIHVzZS5gIH0sIG51bGwsIDIpKVxuICAgICAgICAgICAgICAgIHJlcy5lbmQoKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIGJjcnlwdCA9IHJlcXVpcmUoJ2JjcnlwdGpzJyk7XG4gICAgICAgICAgICAgICAgdmFyIHNhbHQgPSBiY3J5cHQuZ2VuU2FsdFN5bmMoMTApO1xuICAgICAgICAgICAgICAgIHZhciBoYXNoID0gYmNyeXB0Lmhhc2hTeW5jKHJlcS5zd2FnZ2VyLnBhcmFtcy5zY2hlZHVsZXJpbmZvLnZhbHVlLnBhc3N3b3JkLCBzYWx0KTtcblxuICAgICAgICAgICAgICAgIHJlcS5zd2FnZ2VyLnBhcmFtcy5zY2hlZHVsZXJpbmZvLnZhbHVlLnBhc3N3b3JkID0gaGFzaDtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBkYi5TY2hlZHVsZXIuaW5zZXJ0T25lKHJlcS5zd2FnZ2VyLnBhcmFtcy5zY2hlZHVsZXJpbmZvLnZhbHVlKS50aGVuKCh3cml0ZU9wUmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXEuc2Vzc2lvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVxLnNlc3Npb24uZW1haWwgPSByZXEuc3dhZ2dlci5wYXJhbXMuc2NoZWR1bGVyaW5mby52YWx1ZS5lbWFpbFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVxLnNlc3Npb24ubG9naWQgPSB3cml0ZU9wUmVzdWx0Lmluc2VydGVkSWQudG9IZXhTdHJpbmcoKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVxLnNlc3Npb24udHlwZSA9IFwiU2NoZWR1bGVyXCJcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHJlcy5zdGF0dXMoT0spXG4gICAgICAgICAgICAgICAgICAgIHJlcy5zZW5kKEpTT04uc3RyaW5naWZ5KHsgbWVzc2FnZTogXCJJdCB3b3JrZWQhXCIgfSwgbnVsbCwgMikpXG4gICAgICAgICAgICAgICAgICAgIHJlcy5lbmQoKVxuICAgICAgICAgICAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmVzLnN0YXR1cyhJbnRlcm5hbFNlcnZlckVycm9yKVxuICAgICAgICAgICAgICAgICAgICByZXMuc2VuZChKU09OLnN0cmluZ2lmeSh7IG1lc3NhZ2U6IGluc3BlY3QoZXJyKSB9LCBudWxsLCAyKSlcbiAgICAgICAgICAgICAgICAgICAgcmVzLmVuZCgpXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgcmVzLnN0YXR1cyhJbnRlcm5hbFNlcnZlckVycm9yKVxuICAgICAgICAgICAgcmVzLnNlbmQoSlNPTi5zdHJpbmdpZnkoeyBtZXNzYWdlOiBpbnNwZWN0KGVycikgfSwgbnVsbCwgMikpXG4gICAgICAgICAgICByZXMuZW5kKClcbiAgICAgICAgfSlcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJlcy5zdGF0dXMoQmFkUmVxdWVzdClcbiAgICAgICAgcmVzLnNlbmQoSlNPTi5zdHJpbmdpZnkoeyBtZXNzYWdlOiBcIk5hbWUsIEVtYWlsLCBhbmQgcGFzc3dvcmQgYXJlIHJlcXVpcmVkXCIgfSwgbnVsbCwgMikpXG4gICAgICAgIHJlcy5lbmQoKVxuICAgIH1cbn1cblxubW9kdWxlLmV4cG9ydHMuU2NoZWR1bGVyTG9naW4gPSBmdW5jdGlvbiAocmVxOiBhbnksIHJlczogYW55LCBuZXh0OiBhbnkpIHtcbiAgICAvLyBwcmludCBvdXQgdGhlIHBhcmFtc1xuICAgIGNvbnNvbGUubG9nKGluc3BlY3QocmVxLnN3YWdnZXIucGFyYW1zKSlcbiAgICByZXMuc2V0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpXG5cbiAgICAvLyBUaGVzZSBzaG91bGQgYWx3YXlzIGJlIGZpbGxlZCBvdXQgYmVjYXVzZSBvZiB0aGUgc3dhZ2dlciB2YWxpZGF0aW9uLCBidXQgd2Ugc2hvdWxkIHN0aWxsXG4gICAgLy8gcHJvYmFibHkgY2hlY2sgdGhlbS5cbiAgICBpZiAocmVxLnN3YWdnZXIucGFyYW1zLnNjaGVkdWxlcmluZm8udmFsdWUuZW1haWwgJiYgcmVxLnN3YWdnZXIucGFyYW1zLnNjaGVkdWxlcmluZm8udmFsdWUucGFzc3dvcmQpIHtcbiAgICAgICAgZGIuU2NoZWR1bGVyLmZpbmRPbmUoeyAnZW1haWwnOiByZXEuc3dhZ2dlci5wYXJhbXMuc2NoZWR1bGVyaW5mby52YWx1ZS5lbWFpbCB9KS50aGVuKChzY2hlZHVsZXIpID0+IHtcbiAgICAgICAgICAgIHZhciBiY3J5cHQgPSByZXF1aXJlKCdiY3J5cHRqcycpO1xuXG4gICAgICAgICAgICBpZiAoc2NoZWR1bGVyICE9IG51bGwpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFyIGhhc2ggPSBzY2hlZHVsZXIucGFzc3dvcmQ7XG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSBiY3J5cHQuY29tcGFyZShyZXEuc3dhZ2dlci5wYXJhbXMuc2NoZWR1bGVyaW5mby52YWx1ZS5wYXNzd29yZCwgaGFzaCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICByZXEuc3dhZ2dlci5wYXJhbXMuc2NoZWR1bGVyaW5mby52YWx1ZS5wYXNzd29yZCA9IGhhc2g7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBkYi5TY2hlZHVsZXIuZmluZE9uZShyZXEuc3dhZ2dlci5wYXJhbXMuc2NoZWR1bGVyaW5mby52YWx1ZSkudGhlbigoc2NoZWR1bGVyKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHNjaGVkdWxlcikge1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVxLnNlc3Npb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5zZXNzaW9uLmVtYWlsID0gcmVxLnN3YWdnZXIucGFyYW1zLnNjaGVkdWxlcmluZm8udmFsdWUuZW1haWxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5zZXNzaW9uLmxvZ2lkID0gc2NoZWR1bGVyLnNjaGVkdWxlcklEXG4gICAgICAgICAgICAgICAgICAgICAgICByZXEuc2Vzc2lvbi50eXBlID0gXCJTY2hlZHVsZXJcIlxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgXG4gICAgICAgICAgICAgICAgICAgIHJlcy5zdGF0dXMoT0spXG4gICAgICAgICAgICAgICAgICAgIHJlcy5zZW5kKEpTT04uc3RyaW5naWZ5KHsgbWVzc2FnZTogXCJJdCB3b3JrZWQhXCIgfSwgbnVsbCwgMikpXG4gICAgICAgICAgICAgICAgICAgIHJlcy5lbmQoKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzLnN0YXR1cyhCYWRSZXF1ZXN0KVxuICAgICAgICAgICAgICAgICAgICByZXMuc2VuZChKU09OLnN0cmluZ2lmeSh7IG1lc3NhZ2U6IFwiRW1haWwgYW5kIHBhc3N3b3JkIGRpZCBub3QgbWF0Y2ggYW55IGtub3duIHVzZXIsIHlvdXIgaGFzaCBpczogXCJ9LCBudWxsLCAyKSlcbiAgICAgICAgICAgICAgICAgICAgcmVzLmVuZCgpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgICAgIHJlcy5zdGF0dXMoSW50ZXJuYWxTZXJ2ZXJFcnJvcilcbiAgICAgICAgICAgICAgICByZXMuc2VuZChKU09OLnN0cmluZ2lmeSh7IG1lc3NhZ2U6IGluc3BlY3QoZXJyKSB9LCBudWxsLCAyKSlcbiAgICAgICAgICAgICAgICByZXMuZW5kKClcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoSW50ZXJuYWxTZXJ2ZXJFcnJvcilcbiAgICAgICAgICAgIHJlcy5zZW5kKEpTT04uc3RyaW5naWZ5KHsgbWVzc2FnZTogaW5zcGVjdChlcnIpIH0sIG51bGwsIDIpKVxuICAgICAgICAgICAgcmVzLmVuZCgpXG4gICAgICAgIH0pXG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXMuc3RhdHVzKEJhZFJlcXVlc3QpXG4gICAgICAgIHJlcy5zZW5kKEpTT04uc3RyaW5naWZ5KHsgbWVzc2FnZTogXCJFbWFpbCBhbmQgcGFzc3dvcmQgYXJlIHJlcXVpcmVkXCIgfSwgbnVsbCwgMikpXG4gICAgICAgIHJlcy5lbmQoKVxuICAgIH1cbn1cblxubW9kdWxlLmV4cG9ydHMuVXNlclNpZ251cCA9IGZ1bmN0aW9uIChyZXE6IGFwaS5SZXF1ZXN0ICYgc3dhZ2dlclRvb2xzLlN3YWdnZXIyMFJlcXVlc3Q8U2lnbnVwUGF5bG9hZD4sIHJlczogYW55LCBuZXh0OiBhbnkpIHtcbiAgICAvLyBwcmludCBvdXQgdGhlIHBhcmFtc1xuICAgIGNvbnNvbGUubG9nKGluc3BlY3QocmVxLnN3YWdnZXIucGFyYW1zKSlcbiAgICByZXMuc2V0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpXG5cbiAgICAvLyBUaGVzZSBzaG91bGQgYWx3YXlzIGJlIGZpbGxlZCBvdXQgYmVjYXVzZSBvZiB0aGUgc3dhZ2dlciB2YWxpZGF0aW9uLCBidXQgd2Ugc2hvdWxkIHN0aWxsXG4gICAgLy8gcHJvYmFibHkgY2hlY2sgdGhlbS5cbiAgICBpZiAocmVxLnN3YWdnZXIucGFyYW1zLnVzZXJpbmZvLnZhbHVlLmZpcnN0bmFtZSAmJiByZXEuc3dhZ2dlci5wYXJhbXMudXNlcmluZm8udmFsdWUubGFzdG5hbWUgJiYgcmVxLnN3YWdnZXIucGFyYW1zLnVzZXJpbmZvLnZhbHVlLmVtYWlsICYmIHJlcS5zd2FnZ2VyLnBhcmFtcy51c2VyaW5mby52YWx1ZS5wYXNzd29yZCkge1xuICAgICAgICBkYi5Vc2VyLmZpbmRPbmUoeyAnZW1haWwnOiByZXEuc3dhZ2dlci5wYXJhbXMudXNlcmluZm8udmFsdWUuZW1haWwgfSkudGhlbigodXNlcikgPT4ge1xuICAgICAgICAgICAgaWYgKHVzZXIpIHtcbiAgICAgICAgICAgICAgICByZXMuc3RhdHVzKEJhZFJlcXVlc3QpXG4gICAgICAgICAgICAgICAgcmVzLnNlbmQoSlNPTi5zdHJpbmdpZnkoeyBtZXNzYWdlOiBgRW1haWwgJHtyZXEuc3dhZ2dlci5wYXJhbXMudXNlcmluZm8udmFsdWUuZW1haWx9IGlzIGFscmVhZHkgaW4gdXNlLmAgfSwgbnVsbCwgMikpXG4gICAgICAgICAgICAgICAgcmVzLmVuZCgpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgYmNyeXB0ID0gcmVxdWlyZSgnYmNyeXB0anMnKTtcbiAgICAgICAgICAgICAgICB2YXIgc2FsdCA9IGJjcnlwdC5nZW5TYWx0U3luYygxMCk7XG4gICAgICAgICAgICAgICAgdmFyIGhhc2ggPSBiY3J5cHQuaGFzaFN5bmMocmVxLnN3YWdnZXIucGFyYW1zLnVzZXJpbmZvLnZhbHVlLnBhc3N3b3JkLCBzYWx0KTtcblxuICAgICAgICAgICAgICAgIHJlcS5zd2FnZ2VyLnBhcmFtcy51c2VyaW5mby52YWx1ZS5wYXNzd29yZCA9IGhhc2g7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgZGIuVXNlci5pbnNlcnRPbmUocmVxLnN3YWdnZXIucGFyYW1zLnVzZXJpbmZvLnZhbHVlKS50aGVuKCh3cml0ZU9wUmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXEuc2Vzc2lvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVxLnNlc3Npb24uZW1haWwgPSByZXEuc3dhZ2dlci5wYXJhbXMudXNlcmluZm8udmFsdWUuZW1haWxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5zZXNzaW9uLmxvZ2lkID0gd3JpdGVPcFJlc3VsdC5pbnNlcnRlZElkLnRvSGV4U3RyaW5nKClcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5zZXNzaW9uLnR5cGUgPSBcIlVzZXJcIlxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgcmVzLnN0YXR1cyhPSylcbiAgICAgICAgICAgICAgICAgICAgcmVzLnNlbmQoSlNPTi5zdHJpbmdpZnkoeyBtZXNzYWdlOiBcIkl0IHdvcmtlZCFcIiB9LCBudWxsLCAyKSlcbiAgICAgICAgICAgICAgICAgICAgcmVzLmVuZCgpXG4gICAgICAgICAgICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXMuc3RhdHVzKEludGVybmFsU2VydmVyRXJyb3IpXG4gICAgICAgICAgICAgICAgICAgIHJlcy5zZW5kKEpTT04uc3RyaW5naWZ5KHsgbWVzc2FnZTogaW5zcGVjdChlcnIpIH0sIG51bGwsIDIpKVxuICAgICAgICAgICAgICAgICAgICByZXMuZW5kKClcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfVxuICAgICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICByZXMuc3RhdHVzKEludGVybmFsU2VydmVyRXJyb3IpXG4gICAgICAgICAgICByZXMuc2VuZChKU09OLnN0cmluZ2lmeSh7IG1lc3NhZ2U6IGluc3BlY3QoZXJyKSB9LCBudWxsLCAyKSlcbiAgICAgICAgICAgIHJlcy5lbmQoKVxuICAgICAgICB9KVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmVzLnN0YXR1cyhCYWRSZXF1ZXN0KVxuICAgICAgICByZXMuc2VuZChKU09OLnN0cmluZ2lmeSh7IG1lc3NhZ2U6IFwiTmFtZSwgZW1haWwsIGFuZCBwYXNzd29yZCBhcmUgcmVxdWlyZWRcIiB9LCBudWxsLCAyKSlcbiAgICAgICAgcmVzLmVuZCgpXG4gICAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cy5Vc2VyTG9naW4gPSBmdW5jdGlvbiAocmVxOiBhbnksIHJlczogYW55LCBuZXh0OiBhbnkpIHtcbiAgICAvLyBwcmludCBvdXQgdGhlIHBhcmFtc1xuICAgIGNvbnNvbGUubG9nKGluc3BlY3QocmVxLnN3YWdnZXIucGFyYW1zKSlcbiAgICByZXMuc2V0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpXG5cbiAgICAvLyBUaGVzZSBzaG91bGQgYWx3YXlzIGJlIGZpbGxlZCBvdXQgYmVjYXVzZSBvZiB0aGUgc3dhZ2dlciB2YWxpZGF0aW9uLCBidXQgd2Ugc2hvdWxkIHN0aWxsXG4gICAgLy8gcHJvYmFibHkgY2hlY2sgdGhlbS5cbiAgICBpZiAocmVxLnN3YWdnZXIucGFyYW1zLnVzZXJpbmZvLnZhbHVlLmVtYWlsICYmIHJlcS5zd2FnZ2VyLnBhcmFtcy51c2VyaW5mby52YWx1ZS5wYXNzd29yZCkge1xuICAgICAgICBkYi5Vc2VyLmZpbmRPbmUoeyAnZW1haWwnOiByZXEuc3dhZ2dlci5wYXJhbXMudXNlcmluZm8udmFsdWUuZW1haWwgfSkudGhlbigodXNlcikgPT4ge1xuICAgICAgICAgICAgdmFyIGJjcnlwdCA9IHJlcXVpcmUoJ2JjcnlwdGpzJyk7XG5cbiAgICAgICAgICAgIGlmICh1c2VyICE9IG51bGwpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFyIGhhc2ggPSB1c2VyLnBhc3N3b3JkO1xuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gYmNyeXB0LmNvbXBhcmUocmVxLnN3YWdnZXIucGFyYW1zLnVzZXJpbmZvLnZhbHVlLnBhc3N3b3JkLCBoYXNoKTtcblxuICAgICAgICAgICAgICAgIGlmIChzdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlcS5zd2FnZ2VyLnBhcmFtcy51c2VyaW5mby52YWx1ZS5wYXNzd29yZCA9IGhhc2g7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBkYi5Vc2VyLmZpbmRPbmUocmVxLnN3YWdnZXIucGFyYW1zLnVzZXJpbmZvLnZhbHVlKS50aGVuKCh1c2VyKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHVzZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcS5zZXNzaW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXEuc2Vzc2lvbi5lbWFpbCA9IHJlcS5zd2FnZ2VyLnBhcmFtcy51c2VyaW5mby52YWx1ZS5lbWFpbFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVxLnNlc3Npb24udXNlcmlkID0gdXNlci5faWRcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5zZXNzaW9uLnR5cGUgPSBcIlVzZXJcIlxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgXG4gICAgICAgICAgICAgICAgICAgIHJlcy5zdGF0dXMoT0spXG4gICAgICAgICAgICAgICAgICAgIHJlcy5zZW5kKEpTT04uc3RyaW5naWZ5KHsgbWVzc2FnZTogXCJJdCB3b3JrZWQhXCIgfSwgbnVsbCwgMikpXG4gICAgICAgICAgICAgICAgICAgIHJlcy5lbmQoKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzLnN0YXR1cyhCYWRSZXF1ZXN0KVxuICAgICAgICAgICAgICAgICAgICByZXMuc2VuZChKU09OLnN0cmluZ2lmeSh7IG1lc3NhZ2U6IFwiRW1haWwgYW5kIHBhc3N3b3JkIGRpZCBub3QgbWF0Y2ggYW55IGtub3duIHVzZXIsIHlvdXIgaGFzaCBpczogXCJ9LCBudWxsLCAyKSlcbiAgICAgICAgICAgICAgICAgICAgcmVzLmVuZCgpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgICAgIHJlcy5zdGF0dXMoSW50ZXJuYWxTZXJ2ZXJFcnJvcilcbiAgICAgICAgICAgICAgICByZXMuc2VuZChKU09OLnN0cmluZ2lmeSh7IG1lc3NhZ2U6IGluc3BlY3QoZXJyKSB9LCBudWxsLCAyKSlcbiAgICAgICAgICAgICAgICByZXMuZW5kKClcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoSW50ZXJuYWxTZXJ2ZXJFcnJvcilcbiAgICAgICAgICAgIHJlcy5zZW5kKEpTT04uc3RyaW5naWZ5KHsgbWVzc2FnZTogaW5zcGVjdChlcnIpIH0sIG51bGwsIDIpKVxuICAgICAgICAgICAgcmVzLmVuZCgpXG4gICAgICAgIH0pXG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXMuc3RhdHVzKEJhZFJlcXVlc3QpXG4gICAgICAgIHJlcy5zZW5kKEpTT04uc3RyaW5naWZ5KHsgbWVzc2FnZTogXCJFbWFpbCBhbmQgcGFzc3dvcmQgYXJlIHJlcXVpcmVkXCIgfSwgbnVsbCwgMikpXG4gICAgICAgIHJlcy5lbmQoKVxuICAgIH1cbn1cblxubW9kdWxlLmV4cG9ydHMuVXNlckxvZ291dCA9IGZ1bmN0aW9uIChyZXE6IGFueSwgcmVzOiBhbnksIG5leHQ6IGFueSkge1xuICAgIC8vIHByaW50IG91dCB0aGUgcGFyYW1zXG4gICAgY29uc29sZS5sb2codXRpbC5pbnNwZWN0KHJlcS5zd2FnZ2VyLnBhcmFtcywgZmFsc2UsIEluZmluaXR5LCB0cnVlKSlcblxuICAgIGxldCBlbWFpbCwgbG9naWRcbiAgICBpZiAocmVxLnNlc3Npb24pIHtcbiAgICAgICAgZW1haWwgPSByZXEuc2Vzc2lvbi5lbWFpbFxuICAgICAgICBsb2dpZCA9IHJlcS5zZXNzaW9uLmxvZ2lkXG4gICAgICAgIGRlbGV0ZSByZXEuc2Vzc2lvbi5sb2dpZFxuICAgICAgICBkZWxldGUgcmVxLnNlc3Npb24uZW1haWxcbiAgICAgICAgZGVsZXRlIHJlcS5zZXNzaW9uLnR5cGVcbiAgICB9XG5cbiAgICByZXMuc2V0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpXG4gICAgcmVzLnN0YXR1cyhPSylcbiAgICByZXMuc2VuZChKU09OLnN0cmluZ2lmeSh7IG1lc3NhZ2U6IGBMb2dnZWQgb3V0IHVzZXI6ICR7ZW1haWx9ICR7bG9naWR9YCB9LCBudWxsLCAyKSlcbiAgICByZXMuZW5kKClcbn1cblxubW9kdWxlLmV4cG9ydHMuU2NoZWR1bGVyTG9nb3V0ID0gZnVuY3Rpb24gKHJlcTogYW55LCByZXM6IGFueSwgbmV4dDogYW55KSB7XG4gICAgLy8gcHJpbnQgb3V0IHRoZSBwYXJhbXNcbiAgICBjb25zb2xlLmxvZyh1dGlsLmluc3BlY3QocmVxLnN3YWdnZXIucGFyYW1zLCBmYWxzZSwgSW5maW5pdHksIHRydWUpKVxuXG4gICAgbGV0IGVtYWlsLCBsb2dpZFxuICAgIGlmIChyZXEuc2Vzc2lvbikge1xuICAgICAgICBlbWFpbCA9IHJlcS5zZXNzaW9uLmVtYWlsXG4gICAgICAgIGxvZ2lkID0gcmVxLnNlc3Npb24ubG9naWRcbiAgICAgICAgZGVsZXRlIHJlcS5zZXNzaW9uLmVtYWlsXG4gICAgICAgIGRlbGV0ZSByZXEuc2Vzc2lvbi5sb2dpZFxuICAgICAgICBkZWxldGUgcmVxLnNlc3Npb24udHlwZVxuICAgIH1cblxuICAgIHJlcy5zZXRIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJylcbiAgICByZXMuc3RhdHVzKE9LKVxuICAgIHJlcy5zZW5kKEpTT04uc3RyaW5naWZ5KHsgbWVzc2FnZTogYExvZ2dlZCBvdXQgc2NoZWR1bGVyOiAke2VtYWlsfSAke2xvZ2lkfWAgfSwgbnVsbCwgMikpXG4gICAgcmVzLmVuZCgpXG59ICJdfQ==
